{"version":3,"file":"index.js","sources":["../../src/index.js"],"sourcesContent":["/**\n * simple facade for runtime and compiler\n */\n\nimport XTemplateRuntime from 'xtemplate-runtime';\nimport XTemplateCompiler from 'xtemplate-compiler';\n\nconst { util } = XTemplateRuntime;\nconst { compile } = XTemplateCompiler;\n\n/**\n * xtemplate engine\n *\n *      @example\n *      modulex.use('xtemplate', function(XTemplate){\n *          document.writeln(new XTemplate('{{title}}').render({title:2}));\n *      });\n *\n * @class XTemplate\n * @extends XTemplate.Runtime\n */\nfunction XTemplate(tpl_, config_) {\n  let tpl = tpl_;\n  let config = config_;\n  const tplType = typeof tpl;\n  if (tplType !== 'string' && tplType !== 'function') {\n    config = tpl;\n    tpl = undefined;\n  }\n  config = this.config = util.merge(XTemplate.globalConfig, config);\n  if (tplType === 'string') {\n    try {\n      tpl = this.compile(tpl, config.name);\n    } catch (err) {\n      this.compileError = err;\n    }\n  }\n  XTemplateRuntime.call(this, tpl, config);\n}\n\nfunction Noop() {}\n\nNoop.prototype = XTemplateRuntime.prototype;\nXTemplate.prototype = new Noop();\nXTemplate.prototype.constructor = XTemplate;\n\nutil.mix(XTemplate.prototype, {\n  compile(content, name) {\n    return compile(content, name, this.config);\n  },\n\n  render(data, option, callback_) {\n    let callback = callback_;\n    if (typeof option === 'function') {\n      callback = option;\n    }\n    const compileError = this.compileError;\n    if (compileError) {\n      if (callback) {\n        callback(compileError);\n      } else {\n        throw compileError;\n      }\n    } else {\n      return XTemplateRuntime.prototype.render.apply(this, arguments);\n    }\n  },\n});\n\nexport default util.mix(XTemplate, {\n  globalConfig: {},\n\n  config: XTemplateRuntime.config,\n\n  compile,\n\n  Compiler: XTemplateCompiler,\n\n  Scope: XTemplateRuntime.Scope,\n\n  Runtime: XTemplateRuntime,\n\n  /**\n   * add command to all template\n   * @method\n   * @static\n   * @param {String} commandName\n   * @param {Function} fn\n   */\n  addCommand: XTemplateRuntime.addCommand,\n\n  /**\n   * remove command from all template by name\n   * @method\n   * @static\n   * @param {String} commandName\n   */\n  removeCommand: XTemplateRuntime.removeCommand,\n});\n\n/*\n It consists three modules:\n\n -   xtemplate - Both compiler and runtime functionality.\n -   xtemplate/compiler - Compiler string template to module functions.\n -   xtemplate/runtime -  Runtime for string template( with xtemplate/compiler loaded)\n or template functions.\n\n xtemplate/compiler depends on xtemplate/runtime,\n because compiler needs to know about runtime to generate corresponding codes.\n */\n"],"names":["util","XTemplateRuntime","compile","XTemplateCompiler","XTemplate","tpl_","config_","tpl","config","tplType","undefined","merge","globalConfig","name","err","compileError","call","Noop","prototype","constructor","mix","content","render","data","option","callback_","callback","apply","arguments","Compiler","Scope","Runtime","addCommand","removeCommand"],"mappings":";;;AAAA;AACA;AACA;AAKA,IAAQA,IAAI,GAAKC,gBAAgB,CAAzBD,IAAI;AACZ,IAAQE,QAAO,GAAKC,iBAAiB,CAA7BD,OAAO;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASE,SAAS,CAACC,IAAI,EAAEC,OAAO,EAAE;EAChC,IAAIC,GAAG,GAAGF,IAAI;EACd,IAAIG,MAAM,GAAGF,OAAO;EACpB,IAAMG,OAAO,GAAG,OAAOF,GAAG;EAC1B,IAAIE,OAAO,KAAK,QAAQ,IAAIA,OAAO,KAAK,UAAU,EAAE;IAClDD,MAAM,GAAGD,GAAG;IACZA,GAAG,GAAGG,SAAS;;EAEjBF,MAAM,GAAG,IAAI,CAACA,MAAM,GAAGR,IAAI,CAACW,KAAK,CAACP,SAAS,CAACQ,YAAY,EAAEJ,MAAM,CAAC;EACjE,IAAIC,OAAO,KAAK,QAAQ,EAAE;IACxB,IAAI;MACFF,GAAG,GAAG,IAAI,CAACL,OAAO,CAACK,GAAG,EAAEC,MAAM,CAACK,IAAI,CAAC;KACrC,CAAC,OAAOC,GAAG,EAAE;MACZ,IAAI,CAACC,YAAY,GAAGD,GAAG;;;EAG3Bb,gBAAgB,CAACe,IAAI,CAAC,IAAI,EAAET,GAAG,EAAEC,MAAM,CAAC;AAC1C;AAEA,SAASS,IAAI,GAAG;AAEhBA,IAAI,CAACC,SAAS,GAAGjB,gBAAgB,CAACiB,SAAS;AAC3Cd,SAAS,CAACc,SAAS,GAAG,IAAID,IAAI,EAAE;AAChCb,SAAS,CAACc,SAAS,CAACC,WAAW,GAAGf,SAAS;AAE3CJ,IAAI,CAACoB,GAAG,CAAChB,SAAS,CAACc,SAAS,EAAE;EAC5BhB,OAAO,mBAACmB,OAAO,EAAER,IAAI,EAAE;IACrB,OAAOX,QAAO,CAACmB,OAAO,EAAER,IAAI,EAAE,IAAI,CAACL,MAAM,CAAC;GAC3C;EAEDc,MAAM,kBAACC,IAAI,EAAEC,MAAM,EAAEC,SAAS,EAAE;IAC9B,IAAIC,QAAQ,GAAGD,SAAS;IACxB,IAAI,OAAOD,MAAM,KAAK,UAAU,EAAE;MAChCE,QAAQ,GAAGF,MAAM;;IAEnB,IAAMT,YAAY,GAAG,IAAI,CAACA,YAAY;IACtC,IAAIA,YAAY,EAAE;MAChB,IAAIW,QAAQ,EAAE;QACZA,QAAQ,CAACX,YAAY,CAAC;OACvB,MAAM;QACL,MAAMA,YAAY;;KAErB,MAAM;MACL,OAAOd,gBAAgB,CAACiB,SAAS,CAACI,MAAM,CAACK,KAAK,CAAC,IAAI,EAAEC,SAAS,CAAC;;;AAGrE,CAAC,CAAC;AAEF,YAAe5B,IAAI,CAACoB,GAAG,CAAChB,SAAS,EAAE;EACjCQ,YAAY,EAAE,EAAE;EAEhBJ,MAAM,EAAEP,gBAAgB,CAACO,MAAM;EAE/BN,OAAO,EAAPA,QAAO;EAEP2B,QAAQ,EAAE1B,iBAAiB;EAE3B2B,KAAK,EAAE7B,gBAAgB,CAAC6B,KAAK;EAE7BC,OAAO,EAAE9B,gBAAgB;;AAG3B;AACA;AACA;AACA;AACA;AACA;EACE+B,UAAU,EAAE/B,gBAAgB,CAAC+B,UAAU;;AAGzC;AACA;AACA;AACA;AACA;EACEC,aAAa,EAAEhC,gBAAgB,CAACgC;AAClC,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;"}