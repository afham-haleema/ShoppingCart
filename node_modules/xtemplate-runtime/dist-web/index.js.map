{"version":3,"file":"index.js","sources":["../../src/escape-html.js","../../src/util.js","../../src/scope.js","../../src/commands.js","../../src/linked-buffer.js","../../src/index.js"],"sourcesContent":["/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module variables.\n * @private\n */\n\nvar matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nfunction escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index ? html + str.substring(lastIndex, index) : html;\n}\n\nexport default escapeHtml;\n","// http://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet\n// http://wonko.com/post/html-escaping\n\nimport escapeHtml from './escape-html';\n\nconst SUBSTITUTE_REG = /\\\\?\\{([^{}]+)\\}/g;\nconst win = typeof global !== 'undefined' ? global : self;\n\nconst toString = Object.prototype.toString;\nconst util = {\n  isArray:\n    Array.isArray ||\n    function isArray(obj) {\n      return toString.call(obj) === '[object Array]';\n    },\n\n  keys:\n    Object.keys ||\n    function keys(o) {\n      const result = [];\n      let p;\n\n      for (p in o) {\n        if (o.hasOwnProperty(p)) {\n          result.push(p);\n        }\n      }\n\n      return result;\n    },\n\n  each(object, fn, context = null) {\n    if (object) {\n      let key;\n      let val;\n      let keys;\n      let i = 0;\n      const length = object && object.length;\n      // do not use typeof obj == 'function': bug in phantomjs\n      const isObj =\n        length === undefined ||\n        Object.prototype.toString.call(object) === '[object Function]';\n\n      if (isObj) {\n        keys = util.keys(object);\n        for (; i < keys.length; i++) {\n          key = keys[i];\n          // can not use hasOwnProperty\n          if (fn.call(context, object[key], key, object) === false) {\n            break;\n          }\n        }\n      } else {\n        for (val = object[0]; i < length; val = object[++i]) {\n          if (fn.call(context, val, i, object) === false) {\n            break;\n          }\n        }\n      }\n    }\n    return object;\n  },\n\n  mix(t, s) {\n    if (s) {\n      for (const p in s) {\n        if (s.hasOwnProperty(p)) {\n          t[p] = s[p];\n        }\n      }\n    }\n    return t;\n  },\n\n  globalEval(data) {\n    if (win) {\n      if (win.execScript) {\n        win.execScript(data);\n      } else {\n        /* eslint wrap-iife:0 */\n        (function run(d) {\n          win.eval.call(win, d);\n        })(data);\n      }\n    }\n  },\n\n  substitute(str, o, regexp) {\n    if (typeof str !== 'string' || !o) {\n      return str;\n    }\n\n    return str.replace(regexp || SUBSTITUTE_REG, (match, name) => {\n      if (match.charAt(0) === '\\\\') {\n        return match.slice(1);\n      }\n      return o[name] === undefined ? '' : o[name];\n    });\n  },\n\n  escapeHtml,\n\n  normalizePath(str) {\n    return str.replace(/\\\\/g, '/');\n  },\n\n  splitPath(str) {\n    return util.normalizePath(str).split('/');\n  },\n\n  merge(...args) {\n    let i = 0;\n    const len = args.length;\n    const ret = {};\n    for (; i < len; i++) {\n      const arg = args[i];\n      if (arg) {\n        util.mix(ret, arg);\n      }\n    }\n    return ret;\n  },\n};\n\nexport default util;\n","/**\n * scope resolution for xtemplate like function in javascript but keep original data unmodified\n */\n\nfunction Scope(data, affix, parent) {\n  if (data !== undefined) {\n    this.data = data;\n  } else {\n    this.data = {};\n  }\n  if (parent) {\n    this.parent = parent;\n    this.root = parent.root;\n  } else {\n    this.parent = undefined;\n    this.root = this;\n  }\n  this.affix = affix || {};\n  this.ready = false;\n}\n\nScope.prototype = {\n  isScope: 1,\n\n  constructor: Scope,\n\n  setParent(parentScope) {\n    this.parent = parentScope;\n    this.root = parentScope.root;\n  },\n\n  // keep original data unmodified\n  set(name, value) {\n    this.affix[name] = value;\n  },\n\n  setData(data) {\n    this.data = data;\n  },\n\n  getData() {\n    return this.data;\n  },\n\n  mix(v) {\n    const affix = this.affix;\n    for (const name in v) {\n      if (v.hasOwnProperty(name)) {\n        affix[name] = v[name];\n      }\n    }\n  },\n\n  get(name) {\n    const data = this.data;\n    let v;\n    const affix = this.affix;\n\n    if (data !== null && data !== undefined) {\n      v = data[name];\n    }\n\n    if (v !== undefined) {\n      return v;\n    }\n\n    return affix[name];\n  },\n\n  resolveInternalOuter(parts) {\n    const part0 = parts[0];\n    let v;\n    const self = this;\n    let scope = self;\n    if (part0 === 'this') {\n      v = self.data;\n    } else if (part0 === 'root') {\n      scope = scope.root;\n      v = scope.data;\n    } else if (part0) {\n      /* eslint no-cond-assign:0 */\n      do {\n        v = scope.get(part0);\n      } while (v === undefined && (scope = scope.parent));\n    } else {\n      return [scope.data];\n    }\n    return [undefined, v];\n  },\n\n  resolveInternal(parts) {\n    const ret = this.resolveInternalOuter(parts);\n    if (ret.length === 1) {\n      return ret[0];\n    }\n    let i;\n    const len = parts.length;\n    let v = ret[1];\n    if (v === undefined) {\n      return undefined;\n    }\n    for (i = 1; i < len; i++) {\n      if (v === null || v === undefined) {\n        return v;\n      }\n      v = v[parts[i]];\n    }\n    return v;\n  },\n\n  resolveLooseInternal(parts) {\n    const ret = this.resolveInternalOuter(parts);\n    if (ret.length === 1) {\n      return ret[0];\n    }\n    let i;\n    const len = parts.length;\n    let v = ret[1];\n    for (i = 1; v !== null && v !== undefined && i < len; i++) {\n      v = v[parts[i]];\n    }\n    return v;\n  },\n\n  resolveUp(parts) {\n    return this.parent && this.parent.resolveInternal(parts);\n  },\n\n  resolveLooseUp(parts) {\n    return this.parent && this.parent.resolveLooseInternal(parts);\n  },\n\n  resolveOuter(parts, d) {\n    const self = this;\n    let scope = self;\n    let depth = d;\n    let v;\n    if (!depth && parts.length === 1) {\n      v = self.get(parts[0]);\n      if (v !== undefined) {\n        return [v];\n      }\n      depth = 1;\n    }\n    if (depth) {\n      while (scope && depth--) {\n        scope = scope.parent;\n      }\n    }\n    if (!scope) {\n      return [undefined];\n    }\n    return [undefined, scope];\n  },\n\n  resolveLoose(parts, depth) {\n    const ret = this.resolveOuter(parts, depth);\n    if (ret.length === 1) {\n      return ret[0];\n    }\n    return ret[1].resolveLooseInternal(parts);\n  },\n\n  resolve(parts, depth) {\n    const ret = this.resolveOuter(parts, depth);\n    if (ret.length === 1) {\n      return ret[0];\n    }\n    return ret[1].resolveInternal(parts);\n  },\n};\n\nexport default Scope;\n","/**\n * native commands for xtemplate.\n */\n\nimport Scope from './scope';\nimport util from './util';\n\nconst commands = {\n  // range(start, stop, [step])\n  range(scope, option) {\n    const params = option.params;\n    const start = params[0];\n    const end = params[1];\n    let step = params[2];\n    if (\n      typeof process !== 'undefined' &&\n      process.env.NODE_ENV !== 'production'\n    ) {\n      if (\n        typeof start !== 'number' ||\n        typeof end !== 'number' ||\n        (step && typeof step !== 'number')\n      ) {\n        throw new Error('start/end/step of range must be type number!');\n      }\n    }\n    if (!step) {\n      step = start > end ? -1 : 1;\n    } else if ((start > end && step > 0) || (start < end && step < 0)) {\n      step = -step;\n    }\n    const ret = [];\n    for (let i = start; start < end ? i < end : i > end; i += step) {\n      ret.push(i);\n    }\n    return ret;\n  },\n\n  void() {\n    return undefined;\n  },\n\n  foreach(scope, option, buffer_) {\n    let buffer = buffer_;\n    const params = option.params;\n    const param0 = params[0];\n    const xindexName = params[2] || 'xindex';\n    const valueName = params[1];\n    let xcount;\n    let opScope;\n    let affix;\n    let xindex;\n    if (param0) {\n      xcount = param0.length;\n      for (xindex = 0; xindex < xcount; xindex++) {\n        opScope = new Scope(\n          param0[xindex],\n          {\n            xcount,\n            xindex,\n          },\n          scope,\n        );\n        affix = opScope.affix;\n        if (xindexName !== 'xindex') {\n          affix[xindexName] = xindex;\n          affix.xindex = undefined;\n        }\n        if (valueName) {\n          affix[valueName] = param0[xindex];\n        }\n        buffer = option.fn(opScope, buffer);\n      }\n    }\n    return buffer;\n  },\n\n  forin(scope, option, buffer_) {\n    let buffer = buffer_;\n    const params = option.params;\n    const param0 = params[0];\n    const xindexName = params[2] || 'xindex';\n    const valueName = params[1];\n    let opScope;\n    let affix;\n    let name;\n    // if undefined, will emit warning by compiler\n    if (param0) {\n      for (name in param0) {\n        if (param0.hasOwnProperty(name)) {\n          opScope = new Scope(\n            param0[name],\n            {\n              xindex: name,\n            },\n            scope,\n          );\n          affix = opScope.affix;\n          if (xindexName !== 'xindex') {\n            affix[xindexName] = name;\n            affix.xindex = undefined;\n          }\n          if (valueName) {\n            affix[valueName] = param0[name];\n          }\n          buffer = option.fn(opScope, buffer);\n        }\n      }\n    }\n    return buffer;\n  },\n\n  each(scope, option, buffer) {\n    const params = option.params;\n    const param0 = params[0];\n    if (param0) {\n      if (util.isArray(param0)) {\n        return commands.foreach(scope, option, buffer);\n      }\n      return commands.forin(scope, option, buffer);\n    }\n    return buffer;\n  },\n\n  with(scope, option, buffer_) {\n    let buffer = buffer_;\n    const params = option.params;\n    const param0 = params[0];\n    if (param0) {\n      // skip object check for performance\n      const opScope = new Scope(param0, undefined, scope);\n      buffer = option.fn(opScope, buffer);\n    }\n    return buffer;\n  },\n\n  if(scope, option, buffer_) {\n    let buffer = buffer_;\n    const params = option.params;\n    const param0 = params[0];\n    if (param0) {\n      const fn = option.fn;\n      if (fn) {\n        buffer = fn(scope, buffer);\n      }\n    } else {\n      let matchElseIf = false;\n      const elseIfs = option.elseIfs;\n      const inverse = option.inverse;\n      if (elseIfs) {\n        for (let i = 0, len = elseIfs.length; i < len; i++) {\n          const elseIf = elseIfs[i];\n          matchElseIf = elseIf.test(scope);\n          if (matchElseIf) {\n            buffer = elseIf.fn(scope, buffer);\n            break;\n          }\n        }\n      }\n      if (!matchElseIf && inverse) {\n        buffer = inverse(scope, buffer);\n      }\n    }\n    return buffer;\n  },\n\n  set(scope_, option, buffer) {\n    let scope = scope_;\n    const hash = option.hash;\n    const len = hash.length;\n    for (let i = 0; i < len; i++) {\n      const h = hash[i];\n      const parts = h.key;\n      let depth = h.depth;\n      const value = h.value;\n      if (parts.length === 1) {\n        const root = scope.root;\n        while (depth && root !== scope) {\n          scope = scope.parent;\n          --depth;\n        }\n        scope.set(parts[0], value);\n      } else {\n        const last = scope.resolve(parts.slice(0, -1), depth);\n        if (last) {\n          last[parts[parts.length - 1]] = value;\n        }\n      }\n    }\n    return buffer;\n  },\n\n  include: 1,\n\n  includeOnce: 1,\n\n  parse: 1,\n\n  extend: 1,\n\n  block(scope, option, buffer_) {\n    let buffer = buffer_;\n    const self = this;\n    const runtime = self.runtime;\n    const params = option.params;\n    let blockName = params[0];\n    let type;\n    if (params.length === 2) {\n      type = params[0];\n      blockName = params[1];\n    }\n    const blocks = (runtime.blocks = runtime.blocks || {});\n    const head = blocks[blockName];\n    let cursor;\n    const current = {\n      fn: option.fn,\n      type,\n    };\n    if (!head) {\n      blocks[blockName] = current;\n    } else if (head.type) {\n      if (head.type === 'append') {\n        current.next = head;\n        blocks[blockName] = current;\n      } else if (head.type === 'prepend') {\n        let prev;\n        cursor = head;\n        while (cursor && cursor.type === 'prepend') {\n          prev = cursor;\n          cursor = cursor.next;\n        }\n        current.next = cursor;\n        prev.next = current;\n      }\n    }\n\n    if (!runtime.extendTpl) {\n      cursor = blocks[blockName];\n      while (cursor) {\n        if (cursor.fn) {\n          buffer = cursor.fn.call(self, scope, buffer);\n        }\n        cursor = cursor.next;\n      }\n    }\n\n    return buffer;\n  },\n\n  macro(scope, option, buffer_) {\n    let buffer = buffer_;\n    const hash = option.hash;\n    const params = option.params;\n    const macroName = params[0];\n    const params1 = params.slice(1);\n    const self = this;\n    const runtime = self.runtime;\n    const macros = (runtime.macros = runtime.macros || {});\n    const macro = macros[macroName];\n    // definition\n    if (option.fn) {\n      macros[macroName] = {\n        paramNames: params1,\n        hash,\n        fn: option.fn,\n      };\n    } else if (macro) {\n      const paramValues = macro.hash || {};\n      const paramNames = macro.paramNames;\n      if (paramNames) {\n        for (let i = 0, len = paramNames.length; i < len; i++) {\n          const p = paramNames[i];\n          paramValues[p] = params1[i];\n        }\n      }\n      if (hash) {\n        for (const h in hash) {\n          if (hash.hasOwnProperty(h)) {\n            paramValues[h] = hash[h];\n          }\n        }\n      }\n      const newScope = new Scope(paramValues);\n      // https://github.com/xtemplate/xtemplate/issues/29\n      newScope.root = scope.root;\n      // no caller Scope\n      buffer = macro.fn.call(self, newScope, buffer);\n    } else {\n      const error = `can not find macro: ${macroName}`;\n      buffer.error(error);\n    }\n    return buffer;\n  },\n};\n\ncommands.debugger = function debuggerFn() {\n  util.globalEval('debugger');\n};\n\nexport default commands;\n","/**\n * LinkedBuffer of generate content from xtemplate\n */\nimport util from './util';\n\nfunction Buffer(list, next, tpl) {\n  this.list = list;\n  this.init();\n  this.next = next;\n  this.ready = false;\n  // tpl belongs\n  this.tpl = tpl;\n}\n\nBuffer.prototype = {\n  constructor: Buffer,\n\n  isBuffer: 1,\n\n  init() {\n    this.data = '';\n  },\n\n  append(data) {\n    this.data += data;\n    return this;\n  },\n\n  write(data) {\n    // ignore null or undefined\n    if (data !== null && data !== undefined) {\n      if (data.isBuffer) {\n        return data;\n      }\n      this.data += data;\n    }\n    return this;\n  },\n\n  writeEscaped(data) {\n    // ignore null or undefined\n    if (data !== null && data !== undefined) {\n      if (data.isBuffer) {\n        return data;\n      }\n      this.data += util.escapeHtml(data);\n    }\n    return this;\n  },\n\n  insert() {\n    const self = this;\n    const list = self.list;\n    const tpl = self.tpl;\n    const nextFragment = new Buffer(list, self.next, tpl);\n    const asyncFragment = new Buffer(list, nextFragment, tpl);\n    self.next = asyncFragment;\n    self.ready = true;\n    return asyncFragment;\n  },\n\n  async(fn) {\n    const asyncFragment = this.insert();\n    const nextFragment = asyncFragment.next;\n    fn(asyncFragment);\n    return nextFragment;\n  },\n\n  error(e_) {\n    const callback = this.list.callback;\n    let e = e_;\n    if (callback) {\n      const tpl = this.tpl;\n      if (tpl) {\n        if (!(e instanceof Error)) {\n          e = new Error(e);\n        }\n        const name = tpl.name;\n        const line = tpl.pos.line;\n        const errorStr = `XTemplate error in file: ${name} at line ${line}: `;\n        try {\n          // phantomjs\n          e.stack = errorStr + e.stack;\n          e.message = errorStr + e.message;\n        } catch (e2) {\n          // empty\n        }\n        e.xtpl = {\n          pos: {\n            line,\n          },\n          name,\n        };\n      }\n      this.list.callback = null;\n      callback(e, undefined);\n    }\n  },\n\n  end() {\n    const self = this;\n    if (self.list.callback) {\n      self.ready = true;\n      self.list.flush();\n    }\n    return self;\n  },\n};\n\nfunction LinkedBuffer(callback, config) {\n  const self = this;\n  self.config = config;\n  self.head = new Buffer(self, undefined);\n  self.callback = callback;\n  this.init();\n}\n\nLinkedBuffer.prototype = {\n  constructor: LinkedBuffer,\n\n  init() {\n    this.data = '';\n  },\n\n  append(data) {\n    this.data += data;\n  },\n\n  end() {\n    this.callback(null, this.data);\n    this.callback = null;\n  },\n\n  flush() {\n    const self = this;\n    let fragment = self.head;\n    while (fragment) {\n      if (fragment.ready) {\n        this.data += fragment.data;\n      } else {\n        self.head = fragment;\n        return;\n      }\n      fragment = fragment.next;\n    }\n    self.end();\n  },\n};\n\nLinkedBuffer.Buffer = Buffer;\n\nexport default LinkedBuffer;\n\n/**\n * 2014-06-19 yiminghe@gmail.com\n * string concat is faster than array join: 85ms<-> 131ms\n */\n","/**\n * xtemplate runtime\n */\nimport util from './util';\nimport nativeCommands from './commands';\nimport Scope from './scope';\nimport LinkedBuffer from './linked-buffer';\n\nconst commands = {};\nconst { splitPath } = util;\n\n// for performance: reduce hidden class\nfunction TplWrap(name, runtime, root, scope, buffer, originalName, fn, parent) {\n  this.name = name;\n  this.originalName = originalName || name;\n  this.runtime = runtime;\n  this.root = root;\n  // line counter\n  this.pos = { line: 1 };\n  this.scope = scope;\n  this.buffer = buffer;\n  this.fn = fn;\n  this.parent = parent;\n}\n\nfunction findCommand(runtimeCommands, instanceCommands, parts) {\n  const name = parts[0];\n  let cmd =\n    (runtimeCommands && runtimeCommands[name]) ||\n    (instanceCommands && instanceCommands[name]) ||\n    commands[name];\n  if (parts.length === 1) {\n    return cmd;\n  }\n  if (cmd) {\n    const len = parts.length;\n    for (let i = 1; i < len; i++) {\n      cmd = cmd[parts[i]];\n      if (!cmd) {\n        return false;\n      }\n    }\n  }\n  return cmd;\n}\n\nfunction getSubNameFromParentName(parentName, subName) {\n  if (!parentName) {\n    throw new Error('parent template must have name!');\n  }\n  const parts = splitPath(parentName);\n  const subParts = splitPath(subName);\n  parts.pop();\n  for (let i = 0, l = subParts.length; i < l; i++) {\n    const subPart = subParts[i];\n    if (subPart === '.') {\n      continue;\n    } else if (subPart === '..') {\n      parts.pop();\n    } else {\n      parts.push(subPart);\n    }\n  }\n  return parts.join('/');\n}\n\n// depth: ../x.y() => 1\nfunction callFn(tpl, scope, option, buffer, parts, depth) {\n  let caller;\n  let fn;\n  let command1;\n  if (!depth) {\n    command1 = findCommand(\n      tpl.runtime.commands,\n      tpl.root.config.commands,\n      parts,\n    );\n  }\n  if (command1) {\n    return command1.call(tpl, scope, option, buffer);\n  } else if (command1 !== false) {\n    const callerParts = parts.slice(0, -1);\n    caller = scope.resolve(callerParts, depth);\n    if (caller === null || caller === undefined) {\n      buffer.error(\n        `Execute function \\`${parts.join('.')}\\` \\\nError: ${callerParts.join('.')} is undefined or null`,\n      );\n      return buffer;\n    }\n    fn = caller[parts[parts.length - 1]];\n    if (fn) {\n      // apply(x, undefined) error in ie8\n      try {\n        return fn.apply(caller, option.params || []);\n      } catch (err) {\n        buffer.error(\n          `Execute function \\`${parts.join('.')}\\` Error: ${err.message}`,\n        );\n        return buffer;\n      }\n    }\n  }\n  buffer.error(`Command Not Found: ${parts.join('.')}`);\n  return buffer;\n}\n\nconst utils = {\n  callFn,\n\n  // {{y().z()}}\n  callDataFn(params, parts) {\n    let caller = parts[0];\n    let fn = caller;\n    for (let i = 1; i < parts.length; i++) {\n      const name = parts[i];\n      if (fn && fn[name]) {\n        caller = fn;\n        fn = fn[name];\n      } else {\n        return '';\n      }\n    }\n    return fn.apply(caller, params || []);\n  },\n\n  callCommand(tpl, scope, option, buffer, parts) {\n    return callFn(tpl, scope, option, buffer, parts);\n  },\n};\n\n/**\n * template file name for chrome debug\n *\n * @cfg {Boolean} name\n * @member XTemplate.Runtime\n */\n\n/**\n * XTemplate runtime. only accept tpl as function.\n * @class XTemplate.Runtime\n */\nfunction XTemplateRuntime(fn, config) {\n  this.fn = fn;\n  this.config = util.merge(XTemplateRuntime.globalConfig, config);\n  this.subNameResolveCache = {};\n  this.loadedSubTplNames = {};\n}\n\nutil.mix(XTemplateRuntime, {\n  Scope,\n\n  LinkedBuffer,\n\n  globalConfig: {},\n\n  config(key, v) {\n    const { globalConfig } = this;\n    if (key !== undefined) {\n      if (v !== undefined) {\n        globalConfig[key] = v;\n      } else {\n        util.mix(globalConfig, key);\n      }\n    } else {\n      return globalConfig;\n    }\n  },\n\n  nativeCommands,\n\n  utils,\n\n  util,\n\n  /**\n   * add command to all template\n   * @method\n   * @static\n   * @param {String} commandName\n   * @param {Function} fn\n   * @member XTemplate.Runtime\n   */\n  addCommand(commandName, fn) {\n    commands[commandName] = fn;\n  },\n\n  /**\n   * remove command from all template by name\n   * @method\n   * @static\n   * @param {String} commandName\n   * @member XTemplate.Runtime\n   */\n  removeCommand(commandName) {\n    delete commands[commandName];\n  },\n});\n\nfunction resolve(root, subName_, parentName) {\n  let subName = subName_;\n  if (subName.charAt(0) !== '.') {\n    return subName;\n  }\n  const key = `${parentName}_ks_${subName}`;\n  const nameResolveCache = root.subNameResolveCache;\n  const cached = nameResolveCache[key];\n  if (cached) {\n    return cached;\n  }\n  subName = nameResolveCache[key] = getSubNameFromParentName(\n    parentName,\n    subName,\n  );\n  return subName;\n}\n\nfunction loadInternal(\n  root,\n  name,\n  runtime,\n  scope,\n  buffer,\n  originalName,\n  escape,\n  parentTpl,\n) {\n  const tpl = new TplWrap(\n    name,\n    runtime,\n    root,\n    scope,\n    buffer,\n    originalName,\n    undefined,\n    parentTpl,\n  );\n  buffer.tpl = tpl;\n  root.config.loader.load(tpl, (error, tplFn_) => {\n    let tplFn = tplFn_;\n    if (typeof tplFn === 'function') {\n      tpl.fn = tplFn;\n      // reduce count of object field for performance\n      /* eslint no-use-before-define:0 */\n      renderTpl(tpl);\n    } else if (error) {\n      buffer.error(error);\n    } else {\n      tplFn = tplFn || '';\n      if (escape) {\n        buffer.writeEscaped(tplFn);\n      } else {\n        buffer.data += tplFn;\n      }\n      buffer.end();\n    }\n  });\n}\n\nfunction includeInternal(root, scope, escape, buffer, tpl, originalName) {\n  const name = resolve(root, originalName, tpl.name);\n  const newBuffer = buffer.insert();\n  const next = newBuffer.next;\n  loadInternal(\n    root,\n    name,\n    tpl.runtime,\n    scope,\n    newBuffer,\n    originalName,\n    escape,\n    buffer.tpl,\n  );\n  return next;\n}\n\nfunction includeModuleInternal(root, scope, buffer, tpl, tplFn) {\n  const newBuffer = buffer.insert();\n  const next = newBuffer.next;\n  const newTpl = new TplWrap(\n    tplFn.TPL_NAME,\n    tpl.runtime,\n    root,\n    scope,\n    newBuffer,\n    undefined,\n    tplFn,\n    buffer.tpl,\n  );\n  newBuffer.tpl = newTpl;\n  renderTpl(newTpl);\n  return next;\n}\n\nfunction renderTpl(tpl) {\n  const buffer = tpl.fn();\n  // tpl.fn exception\n  if (buffer) {\n    const runtime = tpl.runtime;\n    const extendTpl = runtime.extendTpl;\n    let extendTplName;\n    if (extendTpl) {\n      extendTplName = extendTpl.params[0];\n      if (!extendTplName) {\n        return buffer.error('extend command required a non-empty parameter');\n      }\n    }\n    const extendTplFn = runtime.extendTplFn;\n    const extendTplBuffer = runtime.extendTplBuffer;\n    // if has extend statement, only parse\n    if (extendTplFn) {\n      runtime.extendTpl = null;\n      runtime.extendTplBuffer = null;\n      runtime.extendTplFn = null;\n      includeModuleInternal(\n        tpl.root,\n        tpl.scope,\n        extendTplBuffer,\n        tpl,\n        extendTplFn,\n      ).end();\n    } else if (extendTplName) {\n      runtime.extendTpl = null;\n      runtime.extendTplBuffer = null;\n      includeInternal(\n        tpl.root,\n        tpl.scope,\n        0,\n        extendTplBuffer,\n        tpl,\n        extendTplName,\n      ).end();\n    }\n    return buffer.end();\n  }\n}\n\nfunction getIncludeScope(scope, option, buffer) {\n  const params = option.params;\n  if (!params[0]) {\n    return buffer.error('include command required a non-empty parameter');\n  }\n  let newScope = scope;\n  let newScopeData = params[1];\n  const hash = option.hash;\n  if (hash) {\n    if (newScopeData) {\n      newScopeData = util.mix({}, newScopeData);\n    } else {\n      newScopeData = {};\n    }\n    util.mix(newScopeData, hash);\n  }\n  // sub template scope\n  if (newScopeData) {\n    newScope = new Scope(newScopeData, undefined, scope);\n  }\n  return newScope;\n}\n\nfunction checkIncludeOnce(root, option, tpl) {\n  const originalName = option.params[0];\n  const name = resolve(root, originalName, tpl.name);\n  const { loadedSubTplNames } = root;\n  if (loadedSubTplNames[name]) {\n    return false;\n  }\n  loadedSubTplNames[name] = true;\n  return true;\n}\n\nXTemplateRuntime.prototype = {\n  constructor: XTemplateRuntime,\n\n  Scope,\n\n  nativeCommands,\n\n  utils,\n\n  /**\n   * remove command by name\n   * @param commandName\n   */\n  removeCommand(commandName) {\n    const config = this.config;\n    if (config.commands) {\n      delete config.commands[commandName];\n    }\n  },\n\n  /**\n   * add command definition to current template\n   * @param commandName\n   * @param {Function} fn command definition\n   */\n  addCommand(commandName, fn) {\n    const config = this.config;\n    config.commands = config.commands || {};\n    config.commands[commandName] = fn;\n  },\n\n  include(scope, option, buffer, tpl) {\n    return includeInternal(\n      this,\n      getIncludeScope(scope, option, buffer),\n      option.escape,\n      buffer,\n      tpl,\n      option.params[0],\n    );\n  },\n\n  includeModule(scope, option, buffer, tpl) {\n    return includeModuleInternal(\n      this,\n      getIncludeScope(scope, option, buffer),\n      buffer,\n      tpl,\n      option.params[0],\n    );\n  },\n\n  includeOnce(scope, option, buffer, tpl) {\n    if (checkIncludeOnce(this, option, tpl)) {\n      return this.include(scope, option, buffer, tpl);\n    }\n    return buffer;\n  },\n\n  includeOnceModule(scope, option, buffer, tpl) {\n    if (checkIncludeOnce(this, option, tpl)) {\n      return this.includeModule(scope, option, buffer, tpl);\n    }\n    return buffer;\n  },\n\n  /**\n   * get result by merge data with template\n   */\n  render(data, option_, callback_) {\n    let option = option_;\n    let callback = callback_;\n    let html = '';\n    const fn = this.fn;\n    const config = this.config;\n    if (typeof option === 'function') {\n      callback = option;\n      option = null;\n    }\n    option = option || {};\n    if (!callback) {\n      callback = (error_, ret) => {\n        let error = error_;\n        if (error) {\n          if (!(error instanceof Error)) {\n            error = new Error(error);\n          }\n          throw error;\n        }\n        html = ret;\n      };\n    }\n    let name = this.config.name;\n    if (!name && fn && fn.TPL_NAME) {\n      name = fn.TPL_NAME;\n    }\n    let scope;\n    if (data instanceof Scope) {\n      scope = data;\n    } else {\n      scope = new Scope(data);\n    }\n    const buffer = new LinkedBuffer(callback, config).head;\n    const tpl = new TplWrap(\n      name,\n      {\n        commands: option.commands,\n      },\n      this,\n      scope,\n      buffer,\n      name,\n      fn,\n    );\n    buffer.tpl = tpl;\n    if (!fn) {\n      config.loader.load(tpl, (err, fn2) => {\n        if (fn2) {\n          tpl.fn = this.fn = fn2;\n          renderTpl(tpl);\n        } else if (err) {\n          buffer.error(err);\n        }\n      });\n      return html;\n    }\n    renderTpl(tpl);\n    return html;\n  },\n};\n\nexport default XTemplateRuntime;\n\n/**\n * @ignore\n *\n * 2012-09-12 yiminghe@gmail.com\n *  - 参考 velocity, 扩充 ast\n *  - Expression/ConditionalOrExpression\n *  - EqualityExpression/RelationalExpression...\n *\n * 2012-09-11 yiminghe@gmail.com\n *  - 初步完成，添加 tc\n *\n * 对比 template\n *\n *  优势\n *      - 不会莫名其妙报错（with）\n *      - 更多出错信息，直接给出行号\n *      - 更容易扩展 command, sub-tpl\n *      - 支持子模板\n *      - 支持作用域链: ..\\x ..\\..\\y\n *      - 内置 escapeHtml 支持\n *      - 支持预编译\n *      - 支持简单表达式 +-/%* ()\n *      - 支持简单比较 === !===\n *      - 支持类似函数的嵌套命令\n *   劣势\n *      - 不支持完整 js 语法\n */\n"],"names":["matchHtmlRegExp","escapeHtml","string","str","match","exec","escape","html","index","lastIndex","length","charCodeAt","substring","SUBSTITUTE_REG","win","global","self","toString","Object","prototype","util","isArray","Array","obj","call","keys","o","result","p","hasOwnProperty","push","each","object","fn","context","key","val","i","isObj","undefined","mix","t","s","globalEval","data","execScript","run","d","eval","substitute","regexp","replace","name","charAt","slice","normalizePath","splitPath","split","merge","len","ret","arg","Scope","affix","parent","root","ready","isScope","constructor","setParent","parentScope","set","value","setData","getData","v","get","resolveInternalOuter","parts","part0","scope","resolveInternal","resolveLooseInternal","resolveUp","resolveLooseUp","resolveOuter","depth","resolveLoose","resolve","commands","range","option","params","start","end","step","process","env","NODE_ENV","Error","foreach","buffer_","buffer","param0","xindexName","valueName","xcount","opScope","xindex","forin","matchElseIf","elseIfs","inverse","elseIf","test","scope_","hash","h","last","include","includeOnce","parse","extend","block","runtime","blockName","type","blocks","head","cursor","current","next","prev","extendTpl","macro","macroName","params1","macros","paramNames","paramValues","newScope","error","debuggerFn","Buffer","list","tpl","init","isBuffer","append","write","writeEscaped","insert","nextFragment","asyncFragment","async","e_","callback","e","line","pos","errorStr","stack","message","e2","xtpl","flush","LinkedBuffer","config","fragment","TplWrap","originalName","findCommand","runtimeCommands","instanceCommands","cmd","getSubNameFromParentName","parentName","subName","subParts","pop","l","subPart","join","callFn","caller","command1","callerParts","apply","err","utils","callDataFn","callCommand","XTemplateRuntime","globalConfig","subNameResolveCache","loadedSubTplNames","nativeCommands","addCommand","commandName","removeCommand","subName_","nameResolveCache","cached","loadInternal","parentTpl","loader","load","tplFn_","tplFn","renderTpl","includeInternal","newBuffer","includeModuleInternal","newTpl","TPL_NAME","extendTplName","extendTplFn","extendTplBuffer","getIncludeScope","newScopeData","checkIncludeOnce","includeModule","includeOnceModule","render","option_","callback_","error_","fn2"],"mappings":"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"}