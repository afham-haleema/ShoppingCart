const path=require("path");var AsyncFs=require("../utils/async-fs"),xtpl=require("xtpl");class WebpackTemplatePlugin{constructor(e){if(e&&e.config){let o=e.config;o.plugins&&o.plugins.length>0&&e.tpl&&e.tpl.length>0&&e.tpl.forEach(e=>{e.renderObject||(e.renderObject={plugins:o.plugins})})}this.options=e}apply(e){let o=this.options;e.hooks?e.hooks.afterResolvers.tap("WebpackTemplatePlugin",async e=>{console.log(""),console.log("> webpack-template-plugin beforeRun"),console.log(""),o.tpl&&o.tpl.length>0&&o.tpl.forEach(async e=>{try{await new Promise((o,l)=>{xtpl.renderFile(e.src,{renderObject:e.renderObject},async function(n,c){n&&l(n);try{AsyncFs.writeFileSync(e.dest,c),console.log(""),console.log("> writeFileSync success"),console.log(""),o()}catch(n){throw l(n),console.log(""),console.log(" ======================================"),console.log("            writeFileSync error        "),console.log(" ======================================"),console.log(""),new Error("WebpackTemplatePlugin: 代码编译失败！ "+n)}})})}catch(e){throw console.log(" ======================================"),console.log("             renderFile error          "),console.log(" ======================================"),new Error("WebpackTemplatePlugin: 代码编译失败！ "+e)}}),console.log(""),console.log("> webpack-template-plugin finish"),console.log("")}):e.plugin("after-resolvers",function(e,l){console.log(""),console.log("> webpack-template-plugin beforeRun"),console.log(""),o.tpl&&o.tpl.length>0&&o.tpl.forEach(async e=>{try{await new Promise((o,l)=>{xtpl.renderFile(e.src,{renderObject:e.renderObject},async function(n,c){n&&l(n);try{AsyncFs.writeFileSync(e.dest,c),console.log(""),console.log("> writeFileSync success"),console.log(""),o()}catch(n){throw l(n),console.log(""),console.log(" ======================================"),console.log("            writeFileSync error        "),console.log(" ======================================"),console.log(""),new Error("WebpackTemplatePlugin: 代码编译失败！ "+n)}})})}catch(e){throw console.log(" ======================================"),console.log("             renderFile error          "),console.log(" ======================================"),new Error("WebpackTemplatePlugin: 代码编译失败！ "+e)}}),console.log(""),console.log("> webpack-template-plugin finish"),console.log("")})}}module.exports=WebpackTemplatePlugin;